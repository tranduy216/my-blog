---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import "../../styles/global.css";


const { locale } = Astro.params;
const base = import.meta.env.BASE_URL;

const categories = ["technical", "physical", "mental"] as const;
type Category = typeof categories[number];
type Post = {
  slug: string;
  data: {
    title: string;
    date: string;
  };
};

// âœ… define type cho section
type Section = {
  name: Category;
  items: Post[];
};

// âœ… fix unknown a/b
function sortByNumber(a: Post, b: Post) {
  return a.slug.localeCompare(b.slug, undefined, { numeric: true });
}

// âœ… khai bÃ¡o type cho sections
const sections: Section[] = [];

for (const category of categories) {
  const key =
    `${locale}/${category}` as keyof import("astro:content").DataEntryMap;

  const posts = (await getCollection(key)) as Post[];

  sections.push({
    name: category,
    items: posts.sort(sortByNumber),
  });
}

export async function getStaticPaths() {
  return [
    { params: { locale: "vi" } },
    { params: { locale: "en" } },
  ];
}

---

<Layout title="Home">
  <main class="container">
    <h1>Blog Tree ({locale})</h1>

    {sections.map((section) => (
      <div class="folder">
        <div class="folder-title">ðŸ“‚ {section.name}</div>

        <ul>
          {section.items.map((post) => (
            <li>
              <a href={`${base}/${locale}/${section.name}/${post.slug}`}>
                {post.slug}. {post.data.title}. {post.data.date}
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </main>
</Layout>